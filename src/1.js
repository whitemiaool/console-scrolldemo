"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();exports.default=function(){var e=console.log,t=console.error,n=Promise.prototype.catch,i=0,o=null,r=Symbol(),a=Symbol(),s=Symbol(),l=Symbol(),d=Symbol(),c=Symbol(),u=Symbol(),p=Symbol(),h=Symbol(),b=Symbol(),f=Symbol(),v=Symbol(),y=Symbol(),m=Symbol(),g=Symbol(),x=Symbol(),E=Symbol(),k=Symbol(),w=Symbol(),j=function(){function e(){_classCallCheck(this,e),this.initNet()}return _createClass(e,[{key:"initNet",value:function(){this.ajaxPolyfill(),this.rewriteAjax(),this.initNetEvent()}},{key:"ajaxPolyfill",value:function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}if("function"==typeof window.self.CustomEvent)return!1;e.prototype=window.self.Event.prototype,window.self.CustomEvent=e}},{key:"rewriteAjax",value:function(){function e(e){var t=new CustomEvent(e,{detail:this});window.self.dispatchEvent(t)}function t(){var t=new n;return t.addEventListener("abort",function(){e.call(this,"ajaxAbort")},!1),t.addEventListener("error",function(){e.call(this,"ajaxError")},!1),t.addEventListener("load",function(){e.call(this,"ajaxLoad")},!1),t.addEventListener("loadstart",function(){e.call(this,"ajaxLoadStart")},!1),t.addEventListener("progress",function(){e.call(this,"ajaxProgress")},!1),t.addEventListener("timeout",function(){e.call(this,"ajaxTimeout")},!1),t.addEventListener("loadend",function(){e.call(this,"ajaxLoadEnd")},!1),t.addEventListener("readystatechange",function(){e.call(this,"ajaxReadyStateChange")},!1),t}var n=window.self.XMLHttpRequest;window.self.XMLHttpRequest=t}},{key:"initNetEvent",value:function(){var e=this;window.self.addEventListener("ajaxReadyStateChange",function(t){if(console.warn(t),4===t.detail.readyState){var n={read:t.detail.readyState,url:t.detail.responseURL,status:t.detail.status,response:e.dealHtml(t.detail.responseText)};e[u]()?e.renderNet(n):(e.netarr.unshift(n),e.netarr.length=50)}}),window.self.addEventListener("ajaxAbort",function(t){try{var n={read:t.detail.readyState,url:t.detail.responseURL,status:t.detail.status,response:e.dealHtml(t.detail.responseText)};e[u]()?e.renderNet(n):(e.netarr.unshift(n),e.netarr.length=50)}catch(e){console.log(e)}}),window.self.addEventListener("timeout",function(t){try{var n={read:t.detail.readyState,url:t.detail.responseURL,status:t.detail.status,response:e.dealHtml(t.detail.responseText)};e[u]()?e.renderNet(n):(e.netarr.unshift(n),e.netarr.length=50)}catch(e){console.log(e)}})}}]),e}(),I=function(o){function j(){_classCallCheck(this,j);var e=_possibleConstructorReturn(this,(j.__proto__||Object.getPrototypeOf(j)).call(this));return e[x]=[],e.netarr=[],e[m]=!1,e[g]=!1,e[E]="#root",e.initPromiseCatch(),e[c](),e[w](),e}return _inherits(j,o),_createClass(j,[{key:w,value:function(){var e=this;window.addEventListener("unhandledrejection",function(e){console.log(e)}),window.addEventListener("error",function(t){t.stopPropagation(),e[k](t)},!1)}},{key:"initPromiseCatch",value:function(){Promise.prototype.catch=function(e){function t(e){console.log("catch",e)}n.call(this,t),n.call(this,e)}}},{key:"dealHtml",value:function(e){return e.replace(/<|>/g,function(e){return"<"===e?"&lt":"&gt"})}},{key:"setRootEleSelector",value:function(e){this[E]=e}},{key:k,value:function(e){if(console.log(e),document.querySelector(this[E])){var t=this;setTimeout(function(){if(""===document.querySelector(t[E]).innerHTML.trim()){var n=document.createElement("div"),i=e.error&&e.error.stack&&e.error.stack.replace(/\sat\s/g,"<br>&nbsp;&nbsp;at&nbsp;&nbsp;");n.innerHTML="info:<br>file:"+e.filename+"<br>msg:"+e.message+"<br>stack:"+i+"<br><br>",document.body.appendChild(n)}},1e3)}}},{key:r,value:function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return"id"+(e()+e())+"-"+e()}},{key:a,value:function(){var e=document.createElement("div");e.setAttribute("id",this.wrapId),e.innerHTML='\n                <div id="'+this.toolbarId+'">\n                    <div data-type="1" style="background:#fff" id="'+this.logId+'">Log</div>\n                    <div data-type="2" id="'+this.netId+'">Net</div>\n                </div>\n                <div id="'+this.logId+'id"></div>\n                <div id="'+this.netId+'id"></div>\n                <div id="'+this.clearId+'">clear</div>                     \n            ',document.body.appendChild(e);var t=document.createElement("div");t.setAttribute("id",this.buttonId),t.innerHTML="dConsole",document.body.appendChild(t)}},{key:s,value:function(){var e=document.createElement("style");e.innerHTML="div#"+this.wrapId+" {\n                position: fixed;\n                height: 75vh;\n                width: 100vw;\n                overflow-y:scroll;\n                background:rgb(218, 218, 218);\n                overflow-x: hidden;\n                bottom: 0px;\n                box-sizing: border-box;\n                padding: 30px 3px;\n                display: flex;\n                flex-direction: column;\n                overflow: hidden;\n                z-index:999;\n            }\n            #"+this.toolbarId+" {\n                display: flex;\n                position: absolute;\n                justify-content: space-around;\n                width: 100%;\n                top:0px;\n                height:30px;\n                line-height:30px;\n                left:0px;\n                background:#f3f3f3;\n                border-bottom: 1px solid #ccc;\n            }\n            #"+this.toolbarId+">div {\n                width:50%;\n                text-align:center;\n                border-left: 1px solid #ccc;\n            }\n            #"+this.logId+"id,#"+this.netId+"id {\n                overflow:auto;\n            }\n            #"+this.netId+"id {\n                display:none\n            }\n            div#"+this.logId+"id>div,div#"+this.netId+"id>div{\n                background: #fff;\n                border-top: 1px solid #ccc;\n                padding: 5px 3px;\n                word-break: break-all;\n                min-height:19px;\n            }\n            div#"+this.buttonId+"{\n                border-radius: 5px;\n                position: fixed;\n                left: 14px;\n                top:50%;\n                background: #1abd10;\n                padding: 5px 10px;\n                color: #fff;\n                z-index:9999;\n                box-shadow: 0px 0px 7px 3px rgba(204, 204, 204,0.5);\n            }\n            #"+this.clearId+" {\n                height: 30px;\n                text-align: center;\n                background: #f3f3f3;\n                position: absolute;\n                bottom: 0px;\n                width: 100%;\n                left: 0px;\n                line-height: 30px;\n                border-top: 1px solid #ccc;\n            }\n            div#"+this.netId+"id h5,div#"+this.logId+"id h5 {\n                margin: 0px;\n                color: blue;\n                margin-bottom: 5px;\n                display: inline-block;\n            }\n            .c_p_obj {\n                background: #e6ebff;\n                border-radius: 5px;\n            }\n            .c_p_obj b{\n                color: #0000ff;\n                font-weight: 400;\n            }\n            .c_e_obj {\n                background: #e4cece;\n                border-radius: 5px;\n            }\n            .c_e_obj b{\n                color: red;\n                font-weight: 400;\n            }\n            ",document.head.appendChild(e)}},{key:l,value:function(){this.wrapId=this[r](),this.buttonId=this[r](),this.logId=this[r](),this.netId=this[r](),this.clearId=this[r](),this.toolbarId=this[r](),this[s](),this[a](),this[d](),this.content=document.getElementById(this.logId+"id"),this.netcontent=document.getElementById(this.netId+"id"),this.wrap=document.getElementById(this.wrapId),this.button=document.getElementById(this.buttonId)}},{key:y,value:function(e){this[x].unshift(e),this[x].length=50}},{key:d,value:function(){function e(e){if("H5"===e.target.nodeName){var t=e.target.parentNode.querySelector("div");if(!t)return;var n=t.style.display,i=t.previousSibling.textContent;i=i.slice(1),t.previousSibling.textContent="none"===n?"▼"+i:"▶"+i,t.style.display="none"===n?"block":"none"}}var t=this;document.getElementById(this.logId+"id").addEventListener("click",function(t){e(t)}),document.getElementById(this.netId+"id").addEventListener("click",function(t){e(t)});var n=document.getElementById(this.buttonId);n.addEventListener("click",function(e){t.wrap.style.display="none"===t.wrap.style.display?"flex":"none"},!1),n.addEventListener("touchmove",function(e){if(1==e.targetTouches.length){var t=e.targetTouches[0];n.style.left=t.pageX-48+"px",n.style.top=t.pageY-15+"px"}},!1),document.getElementById(this.clearId).addEventListener("click",function(e){t.content.innerHTML=""},!1),document.getElementById(this.toolbarId).addEventListener("click",function(e){if(e.target.hasAttribute("data-type")){var t=e.target.getAttribute("id"),n=e.target.parentNode,i=n.childNodes;e.target.style.background="#fff";var o=!0,r=!1,a=void 0;try{for(var s,l=i[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var d=s.value;1==d.nodeType&&(d.getAttribute("id")!=t?(document.getElementById(d.getAttribute("id")).style.background="",document.getElementById(d.getAttribute("id")+"id").style.display="none"):document.getElementById(t+"id").style.display="block")}}catch(e){r=!0,a=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw a}}}},!1)}},{key:c,value:function(){var n=this;console.log=function(){var t=[].slice.call(arguments);n[u]()?n.appendOneToBody(arguments):n[y](arguments),e.apply(null,t)},console.error=function(e){var i=[].slice.call(arguments);n[y](arguments),document.querySelector(n[E])&&(t.apply(i),setTimeout(function(){if(""==document.querySelector(n[E]).innerHTML.trim()){var e=document.createElement("div");e.innerHTML="info:<br>"+i[0].replace(/\sin\s/g,"<br>&nbsp;&nbsp;in&nbsp;&nbsp;")+"<br><br>",document.body.insertBefore(e,document.querySelector(n[E]))}},1e3))}}},{key:"appendOneToBody",value:function(e){var t="",n=!0,i=!1,o=void 0;try{for(var r,a=e[Symbol.iterator]();!(n=(r=a.next()).done);n=!0){var s=r.value;"string"==typeof s&&/color:/.test(s)||(t+=(1==e.length?"":this[b](2))+" "+this[v](s))}}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}this[h](this.content,t)}},{key:u,value:function(){return this[m]}},{key:"hackInstall",value:function(){var e=this;this[g]||(this[g]=!0,this[m]=!0,this[l](),this.netarr.reverse().map(function(t,n){e.renderNet(t)}),this[x].reverse().map(function(t,n){e.appendOneToBody(t)}))}},{key:"renderNet",value:function(e){this[h](this.netcontent,"<h5>▶"+e.url+" "+e.status+'</h5><div style="display:none">'+this[f](e)+"</div>",!0)}},{key:v,value:function(e){if(e instanceof MouseEvent)this[p](e);else{if(e instanceof ErrorEvent){i=0;var t=e.error.stack.replace(/\sat\s/g,"<br>&nbsp;&nbsp;at&nbsp;&nbsp;");return'<h5 style="color:red">▶Error</h5><div class="c_e_obj" style="display:none">'+this[f]({filename:e.filename,msg:e.message,stack:t})+"<br>&nbsp;</div>"}if(e instanceof PromiseRejectionEvent){i=0;var n=e.reason.stack.replace(/\sat\s/g,"<br>&nbsp;&nbsp;at&nbsp;&nbsp;");return'<h5 style="color:red">▶Error</h5><div class="c_e_obj" style="display:none">'+this[f]({msg:e.reason.message,stack:n})+"<br>&nbsp;</div>"}if(e instanceof Error){i=0;var o=e.stack.replace(/\sat\s/g,"<br>&nbsp;&nbsp;at&nbsp;&nbsp;");return'<h5 style="color:red">▶Error</h5><div class="c_e_obj" style="display:none">'+this[f]({filename:e.filename,msg:e.message,stack:o})+"<br>&nbsp;</div>"}if(!(e instanceof Event))return"[object Object]"===Object.prototype.toString.call(e)?(i=0,'<h5>▶Object</h5><div class="c_p_obj" style="display:none">{<br> '+this[f](e)+" <br>}&nbsp;</div>"):"[object Array]"===Object.prototype.toString.call(e)?(i=0,'<h5>▶Array</h5><div class="c_p_obj" style="display:none">[<br> '+this[f](e)+" <br>]&nbsp;</div>"):void 0===e||null===e?'<i style="color:#909090">'+JSON.stringify(e)+"</i>":(e="string"==typeof e?e:JSON.stringify(e),e=e&&e.replace(/%c.+?%c/g,""));this[p](e)}}},{key:f,value:function(e,t){var n=[],o=this[b](t?4*i+2:2);i++;for(var r in e){var a=o+"<b>"+r+":</b>&nbsp;";"[object Object]"!==Object.prototype.toString.call(e[r])?(a=""+a+e[r]+",",n.push(a)):(a+="{<br>",a+=""+this[f](e[r],!0),a+="<br>"+o+"},",n.push(a))}return i=1,n.join("<br>")}},{key:b,value:function(e){for(var t=[];e--;)t.push("&nbsp;");return t.join("")}},{key:h,value:function(e,t,n){var i=document.createElement("div");n&&i.setAttribute("data-obj","1"),i.innerHTML=t,e.appendChild(i)}},{key:p,value:function(e){var t=["{"];for(var n in e){var i="&nbsp;&nbsp;"+n+":&nbsp;"+e[n]+",";t.push(i)}t.push("}"),this[h](this.content,'<h5>▶Object</h5><div class="c_p_obj" style="display:none">'+t.join("<br>")+"</div>",!0)}}]),j}(j);return o||(o=new I),o}();